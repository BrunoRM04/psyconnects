<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PsyConnects | Psicólogos Disponibles</title>
    <link rel="stylesheet" href="public/css/styles.css">
    <link rel="shortcut icon" href="public/img/marca/icono.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>

    <header>
        <div class="logo">
            <img src="public/img/marca/logo cuatro.png" alt="Logo">
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="psicologos.html">Psicólogos Disponibles</a></li>
                <li><a href="historia.html">Tu Historia</a></li>
                <li><a href="reseñas.html">Reseñas</a></li>
                <li><a href="ofertas.html">Ofertas Laborales</a></li>
                <li><a href="https://forms.gle/XNqhQksUqjXX6B4p7">Registrarse</a></li>
            </ul>
            <ul class="nav-icons">
                <li><a href="index.html"><i class="fas fa-home"></i></a></li>
                <li><a href="psicologos.html"><i class="fas fa-user-md"></i></a></li>
                <li><a href="historia.html"><i class="fas fa-book"></i></a></li>
                <li><a href="reseñas.html"><i class="fa-solid fa-comments"></i></a></li>
                <li><a href="ofertas.html"><i class="fas fa-briefcase"></i></a></li>
                <li><a href="https://forms.gle/XNqhQksUqjXX6B4p7"><i class="fas fa-user-plus"></i></a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="titulo-con-linea">
            <h1 class="titulo">PSICÓLOGOS DESTACADOS</h1>
        </div>
        <div class="carousel-container">
            <div class="carousel">
                <div class="carousel-track-container">
                    <ul class="carousel-track">
                        
                    </ul>
                </div>
            </div>
            <div class="carousel-nav">
                
            </div>
        </div>
        <div class="titulo-con-linea">
            <h1 class="titulo">PSICÓLOGOS DISPONIBLES</h1>
        </div>
        <section class="filter-container">
            <div>
                <label for="filter-age">Filtrar por Edad:</label>
                <select id="filter-age">
                    <option value="">Seleccionar</option>
                    <option value="menor">Menor a Mayor</option>
                    <option value="mayor">Mayor a Menor</option>
                </select>
            </div>
            <div>
                <label for="filter-price">Filtrar por Precio:</label>
                <select id="filter-price">
                    <option value="">Seleccionar</option>
                    <option value="menor">Menor a Mayor</option>
                    <option value="mayor">Mayor a Menor</option>
                </select>
            </div>
            <div>
                <label for="filter-experience">Filtrar por Experiencia:</label>
                <select id="filter-experience">
                    <option value="">Seleccionar</option>
                    <option value="menor">Menor a Mayor</option>
                    <option value="mayor">Mayor a Menor</option>
                </select>
            </div>
            <div>
                <label for="filter-country">Filtrar por País:</label>
                <select id="filter-country">
                    <option value="">Seleccionar</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Bolivia">Bolivia</option>
                    <option value="Brasil">Brasil</option>
                    <option value="Chile">Chile</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Costa Rica">Costa Rica</option>
                    <option value="Cuba">Cuba</option>
                    <option value="Ecuador">Ecuador</option>
                    <option value="El Salvador">El Salvador</option>
                    <option value="España">España</option>
                    <option value="Guatemala">Guatemala</option>
                    <option value="Honduras">Honduras</option>
                    <option value="México">México</option>
                    <option value="Nicaragua">Nicaragua</option>
                    <option value="Panamá">Panamá</option>
                    <option value="Paraguay">Paraguay</option>
                    <option value="Perú">Perú</option>
                    <option value="República Dominicana">República Dominicana</option>
                    <option value="Uruguay">Uruguay</option>
                    <option value="Venezuela">Venezuela</option>
                </select>
            </div>
        </section>

        <section id="psicologos-list">
        </section>
        <div id="contenedor-tarjetas"></div>

        <div id="loading-indicator" class="loading-hidden">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
        
    </main>

    <footer>
        <div class="footer-container">
            <div class="footer-nav">
                <a href="#">EMPRESAS</a>
                <a href="https://forms.gle/xZERw5gE8yzQELDc8">REGISTRARSE</a>
                <a href="doc/pdf/TÉRMINOS Y CONDICIONES - PSYCONNECTS.pdf">TÉRMINOS Y CONDICIONES</a>
                <a href="#">QUIENES SOMOS</a>
            </div>
            <div class="footer-social">
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Todos Los Derechos Reservados 2024 | @PsyConnects</p>
        </div>
    </footer>

    <script>
document.addEventListener("DOMContentLoaded", () => {
    const filterAge = document.getElementById("filter-age");
    const filterPrice = document.getElementById("filter-price");
    const filterExperience = document.getElementById("filter-experience");
    const filterCountry = document.getElementById("filter-country");
    const contenedor = document.getElementById('contenedor-tarjetas');
    const loadingIndicator = document.getElementById('loading-indicator'); 

    let psicologos = [];
    let currentIndex = 0;
    const increment = 20; 

    fetch('./json/psicologos.json')
        .then(response => response.json())
        .then(data => {
            psicologos = data.psicologos.map(psicologo => ({
                ...psicologo,
                edad: calcularEdad(psicologo.fechaNacimiento)
            }));
            shuffleArray(psicologos);
            displayPsicologos();
        });

    filterAge.addEventListener("change", () => applyFilters());
    filterPrice.addEventListener("change", () => applyFilters());
    filterExperience.addEventListener("change", () => applyFilters());
    filterCountry.addEventListener("change", () => applyFilters());

    function applyFilters() {
        currentIndex = 0;
        contenedor.innerHTML = ""; 
        displayPsicologos(); 
    }

    function displayPsicologos() {
        loadingIndicator.classList.remove('loading-hidden');

        setTimeout(() => {
            const filteredPsicologos = applyAllFilters(psicologos);

            const psicologosToDisplay = filteredPsicologos.slice(currentIndex, currentIndex + increment);

            psicologosToDisplay.forEach(psicologo => {
                const tarjeta = document.createElement('div');
                tarjeta.className = 'tarjeta';
                tarjeta.innerHTML = `
                    <div class="cabecera-tarjeta">
                        <img src="${psicologo.fotoPerfil}" alt="${psicologo.nombre} ${psicologo.apellido}" class="foto-perfil">
                    </div>
                    <div class="cuerpo-tarjeta">
                        <h2>${psicologo.nombre} ${psicologo.apellido}</h2>
                        <div class="detalles">
                            <span class="insignia">${psicologo.edad} Años</span>
                            <span class="insignia">${psicologo.pais}</span>
                        </div>
                        <div class="especialidades">
                            ${psicologo.especializacion.map(esp => `<div class="especialidad">${esp}</div>`).join('')}
                        </div>
                        <a href="public/html/perfil.html?id=${psicologo.id}" class="boton">Ver Perfil ></a>
                    </div>
                `;
                contenedor.appendChild(tarjeta);
            });

            currentIndex += increment;

            loadingIndicator.classList.add('loading-hidden');
        }, 1000); 
    }

    function applyAllFilters(psicologos) {
        let filteredPsicologos = [...psicologos];
        const ageOrder = filterAge.value;
        const priceOrder = filterPrice.value;
        const experienceOrder = filterExperience.value;
        const countryFilter = filterCountry.value;

        if (ageOrder) {
            filteredPsicologos.sort((a, b) => ageOrder === 'menor' ? a.edad - b.edad : b.edad - a.edad);
        }

        if (priceOrder) {
            filteredPsicologos.sort((a, b) => priceOrder === 'menor' ? a.precioServicioHora - b.precioServicioHora : b.precioServicioHora - a.precioServicioHora);
        }

        if (experienceOrder) {
            filteredPsicologos.sort((a, b) => experienceOrder === 'menor' ? a.añosExperiencia - b.añosExperiencia : b.añosExperiencia - a.añosExperiencia);
        }

        if (countryFilter) {
            filteredPsicologos = filteredPsicologos.filter(psicologo => psicologo.pais === countryFilter);
        }

        return filteredPsicologos;
    }

    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight) {
            displayPsicologos();
        }
    });

    function calcularEdad(fechaNacimiento) {
        const hoy = new Date();
        const fechaNac = new Date(fechaNacimiento);
        let edad = hoy.getFullYear() - fechaNac.getFullYear();
        const mes = hoy.getMonth() - fechaNac.getMonth();
        if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNac.getDate())) {
            edad--;
        }
        return edad;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }
});

// Función para mezclar aleatoriamente el array de psicólogos
function shuffleArray(array) {
    return array.sort(() => Math.random() - 0.5);
}

const psychologists = shuffleArray([
    {
        "id": 15,
        "nombre": "María",
        "apellido": "Quero",
        "fotoPerfil": "./public/img/users/maria estefanía.png",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 166,
        "nombre": "Andres",
        "apellido": "Solano",
        "fotoPerfil": "./public/img/users/Andres S.jpg",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 41,
        "nombre": "Stephane",
        "apellido": "Piedrahita Reyes",
        "fotoPerfil": "./public/img/users/stephane piedrahita reyes.jpg",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 43,
        "nombre": "Angeles Jacqueline",
        "apellido": "Santucho",
        "fotoPerfil": "./public/img/users/jacqueline santucho.jpg",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 46,
        "nombre": "Solmar Elizabeth",
        "apellido": "Delgado Parra",
        "fotoPerfil": "./public/img/users/solmar delgado.jpg",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 57,
        "nombre": "Johanna",
        "apellido": "Gómez Durán",
        "fotoPerfil": "./public/img/users/johanna gómez durán.jpg",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 59,
        "nombre": "Daniela",
        "apellido": "Ruiz Mazo",
        "fotoPerfil": "./public/img/users/psicondenados psicología.png",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 98,
        "nombre": "Raquel",
        "apellido": "Peralta",
        "fotoPerfil": "./public/img/users/Raquel Peralta.jpg",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 190,
        "nombre": "Josefa",
        "apellido": "Silva",
        "fotoPerfil": "./public/img/users/Josefa Silva.jpeg",
        "verPerfil": "./public/html/perfil.html"
    },
    {
        "id": 161,
        "nombre": "Flavia",
        "apellido": "Ghiotti",
        "fotoPerfil": "./public/img/users/Flavia Ghiotti.png",
        "verPerfil": "./public/html/perfil.html"
    }
]);

function shuffleArray(array) {
    return array.sort(() => Math.random() - 0.5);
}

const track = document.querySelector('.carousel-track');
const indicators = document.querySelector('.carousel-nav');

psychologists.forEach((psychologist, index) => {
    const li = document.createElement('li');
    li.classList.add('carousel-item');

    li.innerHTML = `
        <img src="${psychologist.fotoPerfil}" alt="${psychologist.nombre} ${psychologist.apellido}" class="profile-img">
        <h3 class="profile-name">${psychologist.nombre} ${psychologist.apellido}</h3>
        <p class="profile-description">Psicólogo/a</p>
    `;

    li.addEventListener('click', () => {
        window.location.href = `${psychologist.verPerfil}?id=${psychologist.id}`;
    });

    track.appendChild(li);

    const indicator = document.createElement('button');
    if (index === 0) indicator.classList.add('active');
    indicators.appendChild(indicator);

    indicator.addEventListener('click', () => {
        currentIndex = index;
        updateCarousel();
    });
});

let startPos = 0;
let currentIndex = 0;
const threshold = 50;
let isMoving = false; 

track.addEventListener('touchstart', (e) => {
    startPos = e.touches[0].clientX;
    isMoving = false;
});

track.addEventListener('touchmove', (e) => {
    const currentPos = e.touches[0].clientX;
    const distance = startPos - currentPos;

    if (!isMoving) { 
        if (distance > threshold && currentIndex < psychologists.length - 1) {
            currentIndex++;
            isMoving = true;
            updateCarousel();
        } else if (distance < -threshold && currentIndex > 0) {
            currentIndex--;
            isMoving = true;
            updateCarousel();
        }
    }
});

function updateCarousel() {
    const itemWidth = track.querySelector('li').getBoundingClientRect().width;
    track.style.transform = `translateX(-${currentIndex * itemWidth}px)`;
    document.querySelector('.carousel-nav .active').classList.remove('active');
    indicators.children[currentIndex].classList.add('active');

    setTimeout(() => isMoving = false, 300); 
}
    </script>

</body>

</html>