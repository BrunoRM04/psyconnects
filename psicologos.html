<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PsyConnects | Psicólogos Disponibles</title>
    <link rel="stylesheet" href="public/css/styles.css">
    <link rel="shortcut icon" href="public/img/marca/icono.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>

    <div class="arrow" onclick="toggleSidebar()">&#9654;</div>
    <div class="sidebar" id="sidebar">
        <button class="close-btn" onclick="toggleSidebar()">Cerrar</button>
        <h3>Más Valorados/as</h3>
        <div id="user-list">
            
        </div>
    </div>

    <header>
        <div class="logo">
            <img src="public/img/marca/logo cuatro.png" alt="Logo">
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="psicologos.html">Psicólogos Disponibles</a></li>
                <li><a href="historia.html">Tu Historia</a></li>
                <li><a href="reseñas.html">Reseñas</a></li>
                <li><a href="ofertas.html">Ofertas Laborales</a></li>
                <li><a href="https://forms.gle/XNqhQksUqjXX6B4p7">Registrarse</a></li>
            </ul>
            <ul class="nav-icons">
                <li><a href="index.html"><i class="fas fa-home"></i></a></li>
                <li><a href="psicologos.html"><i class="fas fa-user-md"></i></a></li>
                <li><a href="historia.html"><i class="fas fa-book"></i></a></li>
                <li><a href="reseñas.html"><i class="fa-solid fa-comments"></i></a></li>
                <li><a href="ofertas.html"><i class="fas fa-briefcase"></i></a></li>
                <li><a href="https://forms.gle/XNqhQksUqjXX6B4p7"><i class="fas fa-user-plus"></i></a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="titulo-con-linea">
            <h1 class="titulo">PSICÓLOGOS DISPONIBLES</h1>
        </div>
        <section class="filter-container">
            <div>
                <label for="filter-age">Filtrar por Edad:</label>
                <select id="filter-age">
                    <option value="">Seleccionar</option>
                    <option value="menor">Menor a Mayor</option>
                    <option value="mayor">Mayor a Menor</option>
                </select>
            </div>
            <div>
                <label for="filter-price">Filtrar por Precio:</label>
                <select id="filter-price">
                    <option value="">Seleccionar</option>
                    <option value="menor">Menor a Mayor</option>
                    <option value="mayor">Mayor a Menor</option>
                </select>
            </div>
            <div>
                <label for="filter-experience">Filtrar por Experiencia:</label>
                <select id="filter-experience">
                    <option value="">Seleccionar</option>
                    <option value="menor">Menor a Mayor</option>
                    <option value="mayor">Mayor a Menor</option>
                </select>
            </div>
            <div>
                <label for="filter-country">Filtrar por País:</label>
                <select id="filter-country">
                    <option value="">Seleccionar</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Bolivia">Bolivia</option>
                    <option value="Brasil">Brasil</option>
                    <option value="Chile">Chile</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Costa Rica">Costa Rica</option>
                    <option value="Cuba">Cuba</option>
                    <option value="Ecuador">Ecuador</option>
                    <option value="El Salvador">El Salvador</option>
                    <option value="España">España</option>
                    <option value="Guatemala">Guatemala</option>
                    <option value="Honduras">Honduras</option>
                    <option value="México">México</option>
                    <option value="Nicaragua">Nicaragua</option>
                    <option value="Panamá">Panamá</option>
                    <option value="Paraguay">Paraguay</option>
                    <option value="Perú">Perú</option>
                    <option value="República Dominicana">República Dominicana</option>
                    <option value="Uruguay">Uruguay</option>
                    <option value="Venezuela">Venezuela</option>
                </select>
            </div>
        </section>

        <section id="psicologos-list">
        </section>
        <div id="contenedor-tarjetas"></div>

        <div id="loading-indicator" class="loading-hidden">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
        
    </main>

    <footer>
        <div class="footer-container">
            <div class="footer-nav">
                <a href="#">EMPRESAS</a>
                <a href="https://forms.gle/xZERw5gE8yzQELDc8">REGISTRARSE</a>
                <a href="doc/pdf/TÉRMINOS Y CONDICIONES - PSYCONNECTS.pdf">TÉRMINOS Y CONDICIONES</a>
                <a href="#">QUIENES SOMOS</a>
            </div>
            <div class="footer-social">
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Todos Los Derechos Reservados 2024 | @PsyConnects</p>
        </div>
    </footer>

    <script>
document.addEventListener("DOMContentLoaded", () => {
    const filterAge = document.getElementById("filter-age");
    const filterPrice = document.getElementById("filter-price");
    const filterExperience = document.getElementById("filter-experience");
    const filterCountry = document.getElementById("filter-country");
    const contenedor = document.getElementById('contenedor-tarjetas');
    const loadingIndicator = document.getElementById('loading-indicator'); // Indicador de carga

    let psicologos = [];
    let currentIndex = 0;
    const increment = 20; // Cantidad de psicólogos a cargar cada vez

    fetch('./json/psicologos.json')
        .then(response => response.json())
        .then(data => {
            psicologos = data.psicologos.map(psicologo => ({
                ...psicologo,
                edad: calcularEdad(psicologo.fechaNacimiento)
            }));
            shuffleArray(psicologos);
            displayPsicologos();
        });

    filterAge.addEventListener("change", () => applyFilters());
    filterPrice.addEventListener("change", () => applyFilters());
    filterExperience.addEventListener("change", () => applyFilters());
    filterCountry.addEventListener("change", () => applyFilters());

    function applyFilters() {
        currentIndex = 0;
        contenedor.innerHTML = ""; // Resetea el contenedor
        displayPsicologos(); // Vuelve a cargar los psicólogos con los filtros aplicados
    }

    function displayPsicologos() {
        // Muestra el indicador de carga
        loadingIndicator.classList.remove('loading-hidden');

        setTimeout(() => {
            const filteredPsicologos = applyAllFilters(psicologos);

            const psicologosToDisplay = filteredPsicologos.slice(currentIndex, currentIndex + increment);

            psicologosToDisplay.forEach(psicologo => {
                const tarjeta = document.createElement('div');
                tarjeta.className = 'tarjeta';
                tarjeta.innerHTML = `
                    <div class="cabecera-tarjeta">
                        <img src="${psicologo.fotoPerfil}" alt="${psicologo.nombre} ${psicologo.apellido}" class="foto-perfil">
                    </div>
                    <div class="cuerpo-tarjeta">
                        <h2>${psicologo.nombre} ${psicologo.apellido}</h2>
                        <div class="detalles">
                            <span class="insignia">${psicologo.edad} Años</span>
                            <span class="insignia">${psicologo.pais}</span>
                        </div>
                        <div class="especialidades">
                            ${psicologo.especializacion.map(esp => `<div class="especialidad">${esp}</div>`).join('')}
                        </div>
                        <a href="public/html/perfil.html?id=${psicologo.id}" class="boton">Ver Perfil ></a>
                    </div>
                `;
                contenedor.appendChild(tarjeta);
            });

            currentIndex += increment;

            // Oculta el indicador de carga una vez que los psicólogos están cargados
            loadingIndicator.classList.add('loading-hidden');
        }, 1000); // Simulación de un pequeño retraso para el efecto visual
    }

    function applyAllFilters(psicologos) {
        let filteredPsicologos = [...psicologos];
        const ageOrder = filterAge.value;
        const priceOrder = filterPrice.value;
        const experienceOrder = filterExperience.value;
        const countryFilter = filterCountry.value;

        if (ageOrder) {
            filteredPsicologos.sort((a, b) => ageOrder === 'menor' ? a.edad - b.edad : b.edad - a.edad);
        }

        if (priceOrder) {
            filteredPsicologos.sort((a, b) => priceOrder === 'menor' ? a.precioServicioHora - b.precioServicioHora : b.precioServicioHora - a.precioServicioHora);
        }

        if (experienceOrder) {
            filteredPsicologos.sort((a, b) => experienceOrder === 'menor' ? a.añosExperiencia - b.añosExperiencia : b.añosExperiencia - a.añosExperiencia);
        }

        if (countryFilter) {
            filteredPsicologos = filteredPsicologos.filter(psicologo => psicologo.pais === countryFilter);
        }

        return filteredPsicologos;
    }

    // Detecta cuando el usuario hace scroll al final para cargar más psicólogos
    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight) {
            displayPsicologos();
        }
    });

    function calcularEdad(fechaNacimiento) {
        const hoy = new Date();
        const fechaNac = new Date(fechaNacimiento);
        let edad = hoy.getFullYear() - fechaNac.getFullYear();
        const mes = hoy.getMonth() - fechaNac.getMonth();
        if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNac.getDate())) {
            edad--;
        }
        return edad;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }
});

function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    const arrow = document.querySelector(".arrow");
    if (sidebar.style.left === "0px") {
        sidebar.style.left = "-250px";
        arrow.innerHTML = "&#9654;"; 
    } else {
        sidebar.style.left = "0px";
        arrow.innerHTML = "&#9664;"; 
    }
}

    </script>

</body>

</html>