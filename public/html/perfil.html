<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PsyConnects | Perfil</title>
    <link rel="stylesheet" href="../../public/css/styles.css">
    <link rel="shortcut icon" href="../../public/img/marca/icono.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, orderBy, query, serverTimestamp, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAn6PR9361-d1oSPhBQFKEUEw015SxM1HM",
            authDomain: "prueba-545bd.firebaseapp.com",
            projectId: "prueba-545bd",
            storageBucket: "prueba-545bd.appspot.com",
            messagingSenderId: "649110694072",
            appId: "1:649110694072:web:e37a4a7f63f271f4a8ac4d"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to load comments
        async function cargarComentarios() {
            const q = query(collection(db, "comentarios"), orderBy("timestamp"));
            onSnapshot(q, (querySnapshot) => {
                const comentariosList = document.getElementById('comentarios-list');
                comentariosList.innerHTML = "";
                querySnapshot.forEach((doc) => {
                    const comentario = doc.data();
                    comentario.id = doc.id;
                    añadirComentario(comentario);
                });
            });
        }

        // Function to add a comment
        async function guardarComentario(comentario) {
            try {
                const docRef = await addDoc(collection(db, "comentarios"), comentario);
                comentario.id = docRef.id;
                añadirComentario(comentario);
            } catch (e) {
                console.error("Error adding comment: ", e);
            }
        }

        // Function to delete a comment
        async function eliminarComentario(id) {
            try {
                await deleteDoc(doc(db, "comentarios", id));
                const comentarioElement = document.querySelector(`.comentario[data-id='${id}']`);
                if (comentarioElement) {
                    comentarioElement.remove();
                }
            } catch (e) {
                console.error("Error removing comment: ", e);
            }
        }

        // Function to add a comment to the DOM
        function añadirComentario(comentario) {
            const comentariosList = document.getElementById('comentarios-list');
            const comentarioElement = document.createElement('div');
            comentarioElement.className = 'comentario';
            comentarioElement.innerHTML = `
                <h4>${comentario.nombre} ${comentario.apellido} (${comentario.pais})</h4>
                <p>${comentario.mensaje}</p>
                <button onclick="eliminarComentario('${comentario.id}')">Eliminar</button>
            `;
            comentarioElement.setAttribute('data-id', comentario.id);
            comentariosList.appendChild(comentarioElement);
        }

        // Event listener for form submission
        document.addEventListener('DOMContentLoaded', function () {
            const comentariosForm = document.getElementById('comentarios-form');
            comentariosForm.addEventListener('submit', function (event) {
                event.preventDefault();
                const nombre = document.getElementById('nombreComentario').value;
                const apellido = document.getElementById('apellidoComentario').value;
                const pais = document.getElementById('paisComentario').value;
                const mensaje = document.getElementById('mensajeComentario').value;

                const comentario = {
                    nombre,
                    apellido,
                    pais,
                    mensaje,
                    timestamp: serverTimestamp()
                };

                guardarComentario(comentario);
                comentariosForm.reset();
            });

            // Load comments when the page loads
            cargarComentarios();
        });

        // Make the delete function available globally
        window.eliminarComentario = eliminarComentario;
    </script>
</head>
<body>

    <header>
        <div class="logo"> 
            <img src="../../public/img/marca/logo cuatro.png" alt="Logo">
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="../../index.html">Inicio</a></li>
                <li><a href="../../psicologos.html">Psicólogos Disponibles</a></li>
                <li><a href="../../investigacion.html">Investigaciones</a></li>
                <li><a href="../../test.html">Test Práctico</a></li>
                <li><a href="../../ofertas.html">Ofertas Laborales</a></li>
                <li><a href="https://forms.gle/XNqhQksUqjXX6B4p7">Registrarse</a></li>
            </ul>
            <ul class="nav-icons">
                <li><a href="../../index.html"><i class="fas fa-home"></i></a></li>
                <li><a href="../../psicologos.html"><i class="fas fa-user-md"></i></a></li>
                <li><a href="../../investigacion.html"><i class="fas fa-book"></i></a></li>
                <li><a href="../../test.html"><i class="fas fa-pencil-alt"></i></a></li>
                <li><a href="../../ofertas.html"><i class="fas fa-briefcase"></i></a></li>
                <li><a href="https://forms.gle/XNqhQksUqjXX6B4p7"><i class="fas fa-user-plus"></i></a></li>
            </ul>
        </nav> 
    </header>

    <main>

        <div class="perfil-container">
            <div class="perfil-info">
                <h2 id="nombre"></h2>
                <div class="detalles-container">
                    <div class="detalles-inline">
                        <div class="detalles" id="edad"></div>
                        <div class="detalles" id="pais"></div>
                        <div class="detalles" id="fechaNacimiento"></div>
                    </div>
                    <div class="detalles" id="correoElectronico"></div>
                    <a class="detalles" id="telefono" href="#"></a>
                    <div class="detalles" id="añosExperiencia"></div>
                    <div class="detalles" id="idiomas"></div>
                    <div class="detalles" id="precioServicioHora"></div>
                </div>
                <button id="reservar-cita" class="reservar-btn">Reservar Cita ></button>
                <div class="redes-sociales">
                    <a id="linkedin" href="#" target="_blank"><i class="fab fa-linkedin"></i></a>
                    <a id="facebook" href="#" target="_blank"><i class="fab fa-facebook"></i></a>
                    <a id="twitter" href="#" target="_blank"><i class="fab fa-twitter"></i></a>
                    <a id="instagram" href="#" target="_blank"><i class="fab fa-instagram"></i></a>
                    <a id="youtube" href="#" target="_blank"><i class="fab fa-youtube"></i></a>
                    <a id="whatsapp" href="#" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    <a id="tiktok" href="#" target="_blank"><i class="fab fa-tiktok"></i></a>
                    <a id="snapchat" href="#" target="_blank"><i class="fab fa-snapchat"></i></a>
                </div>
            </div>
            <div class="perfil-descripcion">
                <h3>Descripción</h3>
                <p id="descripcion"></p>
                <h3>Experiencia</h3>
                <ul id="experiencia"></ul>
                <h3>Certificaciones</h3>
                <ul id="certificaciones"></ul>
            </div>
        </div>

        <div class="comentarios-container">
            <h3>Comentarios</h3>
            <form id="comentarios-form">
                <input type="text" id="nombreComentario" placeholder="Nombre" required>
                <input type="text" id="apellidoComentario" placeholder="Apellido" required>
                <input type="text" id="paisComentario" placeholder="País" required>
                <textarea id="mensajeComentario" placeholder="Escribe tu comentario aquí" required></textarea>
                <button type="submit">Enviar</button>
            </form>
            <div id="comentarios-list"></div>
        </div>

    </main>

    <footer>
        <div class="footer-container">
            <div class="footer-nav">
                <a href="#">EMPRESAS</a>
                <a href="https://forms.gle/xZERw5gE8yzQELDc8">REGISTRARSE</a>
                <a href="../../doc/pdf/TÉRMINOS Y CONDICIONES - PSYCONNECTS.pdf">TÉRMINOS Y CONDICIONES</a>
                <a href="#">QUIENES SOMOS</a>
            </div>
            <div class="footer-social">
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Todos Los Derechos Reservados 2024 | @PsyConnects</p>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const psicologoId = parseInt(urlParams.get('id'), 10);
    
            fetch('../../json/psicologos.json')
            .then(response => response.json())
            .then(data => {
                const psicologo = data.psicologos.find(psic => psic.id === psicologoId);
    
                if (psicologo) {
                    document.getElementById('nombre').textContent = `${psicologo.nombre} ${psicologo.apellido}`;
                    document.getElementById('edad').textContent = `${calcularEdad(psicologo.fechaNacimiento)} Años`;
                    document.getElementById('pais').textContent = psicologo.pais;
                    document.getElementById('fechaNacimiento').textContent = psicologo.fechaNacimiento;
                    document.getElementById('correoElectronico').textContent = psicologo.correoElectronico;
    
                    const telefonoElement = document.getElementById('telefono');
                    telefonoElement.textContent = psicologo.telefono;
                    telefonoElement.href = `https://wa.me/${psicologo.telefono.replace(/[^0-9]/g, '')}?text=Buenas,%20encontré%20su%20perfil%20en%20PsyConnects.`;
    
                    document.getElementById('añosExperiencia').textContent = `${psicologo.añosExperiencia} años de experiencia`;
                    document.getElementById('idiomas').textContent = psicologo.idiomas.join(' - ');
                    document.getElementById('precioServicioHora').textContent = `${psicologo.precioServicioHora} USD x Hora`;
                    document.getElementById('descripcion').textContent = psicologo.descripcion;
    
                    const experienciaList = document.getElementById('experiencia');
                    psicologo.experiencia.forEach(exp => {
                        const li = document.createElement('li');
                        li.textContent = `${exp.puesto} en ${exp.institucion} (${exp.añoInicio}-${exp.añoFin})`;
                        experienciaList.appendChild(li);
                    });
    
                    const certificacionesList = document.getElementById('certificaciones');
                    psicologo.certificaciones.forEach(cert => {
                        const li = document.createElement('li');
                        li.textContent = `${cert.nombre} - ${cert.institucion} (${cert.año})`;
                        certificacionesList.appendChild(li);
                    });
    
                    const linkedinElement = document.getElementById('linkedin');
                    if (psicologo.redesSociales.linkedin) {
                        linkedinElement.href = psicologo.redesSociales.linkedin;
                    } else {
                        linkedinElement.style.display = 'none';
                    }
    
                    const facebookElement = document.getElementById('facebook');
                    if (psicologo.redesSociales.facebook) {
                        facebookElement.href = psicologo.redesSociales.facebook;
                    } else {
                        facebookElement.style.display = 'none';
                    }
    
                    const twitterElement = document.getElementById('twitter');
                    if (psicologo.redesSociales.twitter) {
                        twitterElement.href = psicologo.redesSociales.twitter;
                    } else {
                        twitterElement.style.display = 'none';
                    }
    
                    const instagramElement = document.getElementById('instagram');
                    if (psicologo.redesSociales.instagram) {
                        instagramElement.href = psicologo.redesSociales.instagram;
                    } else {
                        instagramElement.style.display = 'none';
                    }
    
                    const youtubeElement = document.getElementById('youtube');
                    if (psicologo.redesSociales.youtube) {
                        youtubeElement.href = psicologo.redesSociales.youtube;
                    } else {
                        youtubeElement.style.display = 'none';
                    }
    
                    const whatsappElement = document.getElementById('whatsapp');
                    if (psicologo.redesSociales.whatsapp) {
                        whatsappElement.href = `https://wa.me/${psicologo.redesSociales.whatsapp.replace(/[^0-9]/g, '')}?text=Buenas,%20encontré%20su%20perfil%20en%20PsyConnects.`;
                    } else {
                        whatsappElement.style.display = 'none';
                    }
    
                    const tiktokElement = document.getElementById('tiktok');
                    if (psicologo.redesSociales.tiktok) {
                        tiktokElement.href = psicologo.redesSociales.tiktok;
                    } else {
                        tiktokElement.style.display = 'none';
                    }
    
                    const snapchatElement = document.getElementById('snapchat');
                    if (psicologo.redesSociales.snapchat) {
                        snapchatElement.href = psicologo.redesSociales.snapchat;
                    } else {
                        snapchatElement.style.display = 'none';
                    }
    
                    // Botón de reservar cita
                    const reservarCitaBtn = document.getElementById('reservar-cita');
                    reservarCitaBtn.addEventListener('click', function() {
                        const mensajeWhatsApp = `https://wa.me/${psicologo.telefono.replace(/[^0-9]/g, '')}?text=Buenas,%20encontré%20su%20perfil%20en%20PsyConnects.%20Me%20gustaría%20reservar%20una%20cita.`;
                        window.location.href = mensajeWhatsApp;
                    });
                } else {
                    alert('Psicólogo no encontrado');
                }
            });
    
            function calcularEdad(fechaNacimiento) {
                const hoy = new Date();
                const fechaNac = new Date(fechaNacimiento);
                let edad = hoy.getFullYear() - fechaNac.getFullYear();
                const mes = hoy.getMonth() - fechaNac.getMonth();
                if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNac.getDate())) {
                    edad--;
                }
                return edad;
            }
        });

        document.addEventListener('DOMContentLoaded', function () {
    const comentariosForm = document.getElementById('comentarios-form');
    const comentariosList = document.getElementById('comentarios-list');

    // Cargar comentarios desde Firestore al cargar la página
    cargarComentarios();

    // Evento para manejar el envío del formulario de comentarios
    comentariosForm.addEventListener('submit', function (event) {
        event.preventDefault();
        const nombre = document.getElementById('nombreComentario').value;
        const apellido = document.getElementById('apellidoComentario').value;
        const pais = document.getElementById('paisComentario').value;
        const mensaje = document.getElementById('mensajeComentario').value;

        const comentario = {
            nombre,
            apellido,
            pais,
            mensaje,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        // Guardar comentario en Firestore
        db.collection("comentarios").add(comentario)
            .then(function(docRef) {
                comentario.id = docRef.id;
                añadirComentario(comentario);
                comentariosForm.reset();
            })
            .catch(function(error) {
                console.error("Error adding comment: ", error);
            });
    });

    function cargarComentarios() {
        db.collection("comentarios").orderBy("timestamp").onSnapshot(function(querySnapshot) {
            comentariosList.innerHTML = "";
            querySnapshot.forEach(function(doc) {
                let comentario = doc.data();
                comentario.id = doc.id;
                añadirComentario(comentario);
            });
        });
    }

    function añadirComentario(comentario) {
        const comentarioElement = document.createElement('div');
        comentarioElement.className = 'comentario';
        comentarioElement.innerHTML = `
            <h4>${comentario.nombre} ${comentario.apellido} (${comentario.pais})</h4>
            <p>${comentario.mensaje}</p>
            <button onclick="eliminarComentario('${comentario.id}')">Eliminar</button>
        `;
        comentarioElement.setAttribute('data-id', comentario.id);
        comentariosList.appendChild(comentarioElement);
    }

    window.eliminarComentario = function(id) {
        db.collection("comentarios").doc(id).delete()
            .then(function() {
                const comentarioElement = document.querySelector(`.comentario[data-id='${id}']`);
                if (comentarioElement) {
                    comentarioElement.remove();
                }
            })
            .catch(function(error) {
                console.error("Error removing comment: ", error);
            });
    };
});

    </script>

</body>
</html>

